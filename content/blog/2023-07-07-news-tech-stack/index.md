---
title: "é‰…äº¨ç¶²æ–°èå°ˆæ¡ˆæ”¹ç‰ˆ"
date: "2023-07-14"
tags: ["ï¼·ork"]
---

## ç›®éŒ„
* [æ”¹ç‰ˆåŸå› ](#æ”¹ç‰ˆåŸå› )
* [Tech Stack](#tech-stack)
* [å»ºç«‹å°ˆæ¡ˆ](#å»ºç«‹å°ˆæ¡ˆ)
* [Next13](#next13)
* [çµè«–](#çµè«–)

## <h2 id="æ”¹ç‰ˆåŸå› ">æ”¹ç‰ˆåŸå› </h2>
[é‰…äº¨ç¶²æ–°èç¶²ç«™](https://news.cnyes.com/news/cat/headline)å¤§ç´„æ˜¯2017åšäº†ä¸€æ¬¡æ”¹ç‰ˆ,ç•¶æ™‚ä½¿ç”¨çš„ç›¸é—œæŠ€è¡“æ˜¯Node8, React15, Reduxèˆ‡å‰äººæ‰¾äº†ä¸€å€‹ä½¿ç”¨Expresså¯¦ä½œServer Side Renderçš„æ¨£æ¿ä½œç‚ºåŸºåº•ã€‚å…­å¹´å¾Œçš„2023,ç›®å‰Nodeç©©å®šç‰ˆæœ¬å·²ç¶“ä¾†åˆ°18, React18,ä¹Ÿé™¸çºŒå‡ºç¾å¯¦ä½œSSRçš„æ¡†æ¶ä¾‹å¦‚Nextjs, Remixã€‚

React16.8æ¨å‡ºReact hookså¯«æ³•å¾Œ, å¯«Class Componentçš„äººå°±è¶Šä¾†è¶Šå°‘, å‰äººä¸€é–‹å§‹å»ºç«‹çš„MVCæ¶æ§‹èˆ‡Reduxä¹Ÿéš¨è‘—ç¶“æ‰‹çš„äººè¶Šä¾†è¶Šå¤šæ¼¸æ¼¸çš„é é›¢ä¸€é–‹å§‹çš„è¦åŠƒ, ç¾åœ¨èƒ½åœ¨çœ‹è¦‹Viewå±¤å‘¼å«API, æ‰€æœ‰çš„å¯¦ä½œé‚è¼¯éƒ½é›†ä¸­åœ¨ä¸€å€‹æª”æ¡ˆ, ä¸€å€‹æª”æ¡ˆæœ‰1700å¤šè¡Œ, ç•¶state, propsæ”¹è®Šæ™‚æœƒé€ æˆå¤šé¤˜çš„ç•«é¢é‡æ–°æ¸²æŸ“, å¾ŒçºŒæ¥æ‰‹çš„äººä¹Ÿè¶Šä¾†è¶Šæ”¹ä¸å‹•ã€‚

Nodeç‰ˆæœ¬éèˆŠ,ä¸€äº›æ–°çš„JavaScriptèªæ³•ä¸æ”¯æ´,ç›¸é—œå¥—ä»¶åªå®‰è£è¼ƒèˆŠçš„ç‰ˆæœ¬æˆ–æ˜¯ä¸èƒ½ä½¿ç”¨ã€‚

## <h2 id="tech-stack">Tech Stack</h2>
* [Next13](https://nextjs.org/)
* [React18](https://react.dev/)
* [Node18](https://nodejs.org/en)
* [Linaria](https://github.com/callstack/linaria)
* [Nx](https://nx.dev/)

åœ¨è€ƒæ…®SEOæƒ…æ³ä¸‹å‹¢å¿…æ˜¯è¦é¸æ“‡SSR, Nextåœ¨è™•ç†SSRèˆ‡CSRä¹‹é–“å·²ç¶“è™•ç†æ‰å¾ˆå¤šå•é¡Œ, åŠ ä¸ŠNext13å·²ç”±betaç‰ˆæœ¬è®Šç‚ºç©©å®šç‰ˆæœ¬ã€‚æ–°çš„[Server Component](https://nextjs.org/blog/next-13)æ‡‰è©²ä¹Ÿè§£æ±ºäº†å¾ˆå¤šClientèˆ‡Serveré–“çš„å•é¡Œã€‚

Linariaæ˜¯ä¸€å€‹CSSçš„æ¡†ä»¶,ä¸»æ‰“æ˜¯Zero-runtime CSS in JS, æ¥­ç•Œæ¨™ç«¿Airbnbä¹Ÿå°å…¥äº†é€™å€‹CSS library[Airbnbâ€™s Trip to Linaria](https://medium.com/airbnb-engineering/airbnbs-trip-to-linaria-dc169230bd12)

Nxå‰‡æ˜¯å¸Œæœ›æœªä¾†èƒ½å¤ æ•´åˆæ¨ç‰ˆæµç¨‹, ç›®å‰é‰…äº¨ç¶²çš„å°ˆæ¡ˆæ˜¯ä¸€å€‹é …ç›®å°±é–‹ä¸€å€‹gitlab repository, ç›®å‰å¤§ç´„æœ‰æ¥è¿‘10å€‹repository, æœƒé€ æˆä¸€å€‹ç›¸åŒçš„åŠŸèƒ½åœ¨A,B,Cå°ˆæ¡ˆéƒ½è¦ç”¨åˆ°, å°±å¿…é ˆè¦æ¨3æ¬¡ç‰ˆ, å¦‚æœæ˜¯å‹•åˆ°Headerå…¨éƒ¨å°ˆæ¡ˆéƒ½æœ‰ç”¨åˆ°å°±å¿…é ˆæ¯å€‹å°ˆæ¡ˆéƒ½å„åˆ¥æ¨ç‰ˆã€‚Nxæ˜¯å…¶ä¸­ä¸€å€‹monorepoæ¶æ§‹çš„å¯¦ä½œ,æœªä¾†å¦‚æœå°ˆæ¡ˆéƒ½æ•´åˆåˆ°monorepoä¸­èƒ½å¤ æ”¹å–„æ¨å¾ˆå¤šæ¬¡ç‰ˆçš„å•é¡Œã€‚

## <h2 id="å»ºç«‹å°ˆæ¡ˆ">å»ºç«‹å°ˆæ¡ˆ</h2>
1. å»ºç«‹nx monorepoçµæ§‹(å…ˆåˆ‡æ›è‡³node18)
```shell
npx create-nx-workspace@latest --preset=next --packageManager=pnpm
# è¼¸å…¥workspaceåç¨±/çµ„ç¹”åç¨± e.g. org
# è¼¸å…¥nextå°ˆæ¡ˆåç¨± e.g. news
# ç”¢ç”Ÿçš„ç›®éŒ„çµæ§‹ï¼š
# org
#  - apps
#    - news
#  - libs
```

2. å•Ÿå‹•å°ˆæ¡ˆ
```shell
pnpm nx serve news
# åœ¨app/news/prject.jsonæœƒå®šç¾©å°ˆæ¡ˆçš„æŒ‡ä»¤,ä¾‹å¦‚serve
# å°±å¯ä»¥å¾workspaceä¾†æ§åˆ¶æ‰€æœ‰å°ˆæ¡ˆæŒ‡ä»¤,ä¾‹å¦‚å•Ÿå‹•,æ–°å¢,åˆªé™¤ç­‰ç­‰
# é è¨­æ˜¯localhost:4200
```

3. å»ºç«‹uiå…±ç”¨å…ƒä»¶åº«åˆ°libsè³‡æ–™å¤¾ä¸‹
```shell
pnpm nx g @nx/react:lib ui
# org 
#   - libs
#     - ui
```
nxæä¾›ä¸€äº›ç¨‹å¼ç¢¼æ¨¡æ¿å¯ä»¥ç”¢ç”Ÿå„ç¨®ç¯„ä¾‹,ä¾‹å¦‚é€™è£¡ç”¢ç”Ÿlib,æ˜¯ä½¿ç”¨@nx/react:libæ¨¡æ¿, gæ˜¯generateç¸®å¯«

4. ç”Ÿæˆå…±ç”¨å…ƒä»¶åˆ°lib/ui, å¦‚header
```shell
pnpm nx g @nx/react:component header --project=ui
# CREATE libs/ui/src/lib/header/header.spec.tsx
# CREATE libs/ui/src/lib/header/header.tsx
# UPDATE libs/ui/src/index.ts
```

5. åœ¨newsä¸­ä½¿ç”¨å…±ç”¨å…ƒä»¶
```ts
// apps/news/app/layout.tsx
import { Header } from '@org/ui';
...
return (
    <html lang="en">
      <body>
        <Header />
        {children}
      </body>
    </html>
  );
...
```
![next-with-header](./step5.png)

6. å®‰è£[Linaria](https://github.com/callstack/linaria)
```shell
pnpm i next-with-linaria @linaria/babel-preset @linaria/core @linaria/react
```

next13å’Œlinariaæ•´åˆé‚„æœ‰é»å•é¡Œ, [next-with-linaria](https://github.com/dlehmhus/next-with-linaria)æå‡ºäº†è§£æ³•,ä½†æ˜¯åœ¨readmeä¸­ä¹Ÿå¯«åˆ°æ­£åœ¨é–‹ç™¼ä¸­ä¸è¦ç”¨åˆ°prodä¸­,éœ€è¦å†æŒçºŒçœ‹ä¹‹å¾Œæœ‰ä»€éº¼æ–°çš„æ•´åˆæ–¹å¼ã€‚

 ```ts
  // next.config.ts
  const withLinaria = require('next-with-linaria');
  const plugins = [withNx, withLinaria];
  ```

```ts
import { styled } from '@linaria/react';
const Title = styled.h1`
  color: red;
  font-size: 36px;
`;
```

```tsx
<div id="welcome">
  <Title>
    <span> Hello there, </span>
    Welcome news ğŸ‘‹
  </Title>
</div>
```

![linaria-title](./step6.png)

## <h2 id="next13">Next13</h2>
* Next13çš„App routing, åŠ å¼·äº†ä»¥å‰pages routingæ–¹å¼, æ•´åˆäº†layout, loading, errorç­‰åŠŸèƒ½ã€‚
* é è¨­æ˜¯Server Component, ä¹Ÿæ¨æ£„æ‰ä»¥å‰çš„getInitialProps, getServerPropsã€‚å¦‚æœæ˜¯Client Componentéœ€è¦åœ¨é–‹é ­çš„åœ°æ–¹åŠ ä¸Š'use client'
* Next13é‡å°fetchå„ªåŒ–, æ”¯æ´cacheå’Œrevalidate

[Next.js App Router: Routing, Data Fetching, Caching - Vercel](https://www.youtube.com/watch?v=gSSsZReIFRk)

## <h2 id="çµè«–">çµè«–</h2>
* åœ¨æ”¹ç‰ˆéƒ¨åˆ†ç¢°ä¸Šäº†ä¸€äº›æŒ‘æˆ°,ç›®å‰æ˜¯é‡æ–°é–‹å•Ÿä¸€å€‹æ–°çš„å°ˆæ¡ˆè€Œä¸æ˜¯èˆŠç‰ˆçš„ç¹¼çºŒå¾€ä¸Šå‡ç´š,ä¸»è¦è€ƒé‡æ˜¯å‡ç´šæ‡‰è©²æœƒæ›´æ£˜æ‰‹ã€‚å¾Œé¢æœƒé™¸çºŒç¢°åˆ°èˆŠå…ƒä»¶å…±ç”¨/é‡åšå•é¡Œã€CICDå•é¡Œã€å¿«å–å•é¡Œã€ç™»å…¥å•é¡Œã€‚
* ç›®å‰é‚„åœ¨è£½ä½œprototype,æœ‰ä¸€å€‹monorepoçµæ§‹åŒ…å«Nextjså°ˆæ¡ˆå’Œä¸€å€‹å…±ç”¨UIå°ˆæ¡ˆ, ä¹‹å¾Œå°ˆæ¡ˆå¦‚æœä¹Ÿè¦å‡ç´šæœƒä¸€èµ·æ•´åˆåˆ°monorepoä¸­ã€‚
